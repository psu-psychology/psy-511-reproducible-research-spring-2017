# 2017-02-13
Rick O. Gilmore  
`r Sys.Date()`  
<!-- Lecture -->



## Today's topics

- Some observations about GitHub use and R Markdown
- Simulation as a tool for reproducible and transparent science
- Visualization tools in R

## Observations about GitHub use

- You're in charge of what goes where.
- Public repos are public, but no one knows what you're doing unless you alert them.
    - If you create a repo in your own account, add `rogilmore` or other collaborators to use the `@rogilmore` type at-mentions feature.
    - Files you create in `https://github.com/psu-psych-511-2017-spring` I can already comment on.

## Observations about GitHub use

- Pull requests are when you edit my code and want me to "pull"/adopt it.
    - If I'm a collaborator on the project with `write` privileges, I don't have to issue a pull request.

## Observations about R Markdown

- Ok to make multiple R Markdown files
- Make sure to add spaces where they belong: `##Header` vs. `## Header`
- Comments! Add them. This is your record of what you did.
- Don't forget you can hide things

## Be a risk-taker; be your own professor

- <http://www.stat.cmu.edu/~cshalizi/rmarkdown>
- <http://stat545.com/bit006_github-browsability-wins.html>

## Simulation as a tool for reproducible and transparent science

- Why simulate
- What to simulate
- How to simulate

## Why & what to simulate?

- Explore sample sizes, effect sizes, power
- Pre-plan/test, polish data-munging workflows
- Make hypotheses even more explicit
    + Simulation == Pregistration on steroids
    + '~~X affects Y~~' -> 'Mean(X) > Mean(Y)'
    + or 'Mean(X) >= 2*Mean(Y)'
- Simulate data analysis in advance

---

- Plan data visualizations in advance
- Avoid avoidable errors
- Plan your work, work your plan
- Super easy to run analyses when your data come in

## How to simulate

- R functions
- R Markdown document(s)

## Super-simple example

- Hypothesis 1: Height (inches) is correlated with weight (lbs)


```r
# choose sample size
sample.n <- 200

# choose intercept and slope
beta0 <- 36   # inches
beta1 <- 0.33  # Rick's guess

# choose standard deviation for error
sigma <- 10 # Rick's guess
```

---


```r
# random weights between 80 lbs and 250 lbs (uniform sampling)
w <- runif(n = sample.n, min = 80, max = 250)

h.pred <- rep(x = beta0, n = sample.n) + beta1 * w
h <- h.pred + rnorm(n = sample.n, mean = 0, sd = sigma)
```

<!-- Code to make scrolling slides -->
<style>
slides > slide { overflow: scroll; }
slides > slide:not(.nobackground):before {
  background: none;
  }
slides > slide:not(.nobackground):after {
  content: '';
  background: none;
  }
}
</style>
---


```r
library(ggplot2)
library(dplyr)
```

```
## 
## Attaching package: 'dplyr'
```

```
## The following objects are masked from 'package:stats':
## 
##     filter, lag
```

```
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
```

```r
hist(w)
```

![](2017-02-13_files/figure-html/plot-hist-1.png)<!-- -->

```r
hist(h)
```

![](2017-02-13_files/figure-html/plot-hist-2.png)<!-- -->

```r
hist(h.pred)
```

![](2017-02-13_files/figure-html/plot-hist-3.png)<!-- -->

---


```r
# Put h and w into data frame for ggplot
height.weight <- data.frame(inches = h, lbs = w)

# Plot
scatter.1 <- ggplot(data = height.weight) +
  aes(x = lbs, y = inches) +
  geom_point()
scatter.1
```

![](2017-02-13_files/figure-html/plot-scatter-1.png)<!-- -->

## That's synthesis, now analysis

- Remember Hypothesis 1: Height (inches) is correlated with weight (lbs)?


```r
# Could use the raw data
# cor.test(x = w, y = h)
# Or, to use the values in the data frame, use with(...)

with(height.weight, cor.test(x = inches, y = lbs))
```

```
## 
## 	Pearson's product-moment correlation
## 
## data:  inches and lbs
## t = 22.89, df = 198, p-value < 2.2e-16
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.8087606 0.8859380
## sample estimates:
##       cor 
## 0.8519103
```

## Aside: extracting the statistics to make an interactive report


```r
# Save output as a variable
cor.test.inches.lbs <- with(height.weight, cor.test(x = inches, y = lbs))

# What sort of beast is this?
mode(cor.test.inches.lbs)
```

```
## [1] "list"
```

---


```r
# Aha, it's a list, this shows me all of the parts
unlist(cor.test.inches.lbs)
```

```
##                            statistic.t 
##                     "22.8904340645698" 
##                           parameter.df 
##                                  "198" 
##                                p.value 
##                  "1.5782975759149e-57" 
##                           estimate.cor 
##                    "0.851910280721883" 
##                 null.value.correlation 
##                                    "0" 
##                            alternative 
##                            "two.sided" 
##                                 method 
## "Pearson's product-moment correlation" 
##                              data.name 
##                       "inches and lbs" 
##                              conf.int1 
##                    "0.808760647062237" 
##                              conf.int2 
##                    "0.885937950888282"
```

```r
# Looks like the t value is the first element
cor.test.inches.lbs[[1]]
```

```
##        t 
## 22.89043
```

---

The Pearson's product-moment correlation correlation between height and weight is 0.8519103, t(198)=22.8904341, p=1.5782976\times 10^{-57}, with a 95% confidence interval of [0.8087606, 0.885938].

<span class="blue">Obviously, we should do some formatting before submitting this, but you get the idea.</span>

## Now back to analysis with our synthetic data


```r
fit <- lm(formula = inches ~ lbs, data = height.weight)
summary(fit)
```

```
## 
## Call:
## lm(formula = inches ~ lbs, data = height.weight)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -35.083  -6.269  -0.601   6.281  29.913 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 33.88797    2.51868   13.46   <2e-16 ***
## lbs          0.33445    0.01461   22.89   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 10.12 on 198 degrees of freedom
## Multiple R-squared:  0.7258,	Adjusted R-squared:  0.7244 
## F-statistic:   524 on 1 and 198 DF,  p-value: < 2.2e-16
```

```r
(ci <- confint(fit)) # saves in variable ci and prints
```

```
##                  2.5 %     97.5 %
## (Intercept) 28.9210976 38.8548517
## lbs          0.3056389  0.3632652
```

## How'd we do?

| Parameter | Actual    | Low Estimate | High Estimate |
|-----------|-----------|--------------|---------------|
| $\beta0$  | 36 | 28.9210976  | 38.8548517   |
| $\beta1$  | 0.33 | 0.3056389  | 0.3632652   |

- Why off on the slope ($\beta1$)
- Random error, probably. Could run again.

---


```
## 
## Call:
## lm(formula = inches ~ lbs, data = height.weight)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -23.6787  -6.4302  -0.5004   6.2845  24.3326 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 34.77564    2.62080   13.27   <2e-16 ***
## lbs          0.33713    0.01476   22.84   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 9.703 on 198 degrees of freedom
## Multiple R-squared:  0.7249,	Adjusted R-squared:  0.7235 
## F-statistic: 521.8 on 1 and 198 DF,  p-value: < 2.2e-16
```

```
##                  2.5 %     97.5 %
## (Intercept) 29.6073729 39.9439074
## lbs          0.3080289  0.3662369
```

---

| Parameter | Actual    | Low Estimate | High Estimate |
|-----------|-----------|--------------|---------------|
| $\beta0$  | 36 | 29.6073729  | 39.9439074   |
| $\beta1$  | 0.33 | 0.3080289  | 0.3662369   |

## Simulation of fMRI data

- Critical review: Welvaert, M., & Rosseel, Y. (2014). A Review of fMRI Simulation Studies. PLOS ONE, 9(7), e101953. <https://doi.org/10.1371/journal.pone.0101953>.
- Welvaert, M., Durnez, J., Moerkerke, B., Berdoolaege, G. & Rosseel, Y. (2011). neuRosim: An R Package for Generating fMRI Data. Journal of Statistical Software, 44(10). Retrieved from <https://www.jstatsoft.org/article/view/v044i10>
- AFNI's *AlphaSim*, <https://afni.nimh.nih.gov/pub/dist/doc/program_help/AlphaSim.html>

# Visualization in R

## Plot first, analyze last

>- Why?
  + [Mike Meyer](https://www.linkedin.com/in/mike-meyer-0056578a) told me so
  + Less biased
  + Easier to be transparent and reproducible
  + Want/need to plot eventually anyway
  + If a picture's worth a thousand words...
>- How?

## How

- Base graphics
    + `plot(x,y)` `hist(x)`, `coplot()`
- `ggplot2`
    + Grammar of graphics
    
## Base graphics

- Try it, maybe you'll like it
- `plot()` takes many types of input
- So does `summary()`
- A little harder to customize

## Data visualization with ggplot2

Wickham, H. & Grolemund, G. (2017). *R for Data Science*. O'Reilly. <http://r4ds.had.co.nz/>

## Let's just walk through the data visualiation chapter

<http://r4ds.had.co.nz/data-visualisation.html>

## Other ggplot2 resources

- Wickham, H. (2010). *ggplot2: Elegant Graphics for Data Analysis (Use R!)* <http://ggplot2.org/book/>
- ggplot2 2.1.0 documentation: <http://docs.ggplot2.org/current/>
